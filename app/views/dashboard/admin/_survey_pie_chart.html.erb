<div class="bg-white rounded-lg shadow-sm p-6 w-[430px] h-[367px]">
  <h3 class="text-xl font-semibold text-[#202020] mb-6">Survey Ratings</h3>
  
  <div class="flex flex-col items-center">
    <div class="w-[180px] h-[180px] relative mb-8">
      <%
        total = @surveys_by_rating.values.sum.to_f
        start_angle = 0
        colors = {
          5 => "#424242",  # darkest grey
          4 => "#757575",  # medium dark grey
          3 => "#A3A3A3",  # medium grey
          2 => "#D4D4D4",  # light grey
          1 => "#FF9A9A"   # coral red
        }
      %>
      <svg viewBox="0 0 100 100" class="w-full h-full transform -rotate-90">
        <% @surveys_by_rating.each do |rating, count| %>
          <% 
            percentage = count / total
            angle = percentage * 360
            end_angle = start_angle + angle
            start_x = 50 + 50 * Math.cos(start_angle * Math::PI / 180)
            start_y = 50 + 50 * Math.sin(start_angle * Math::PI / 180)
            end_x = 50 + 50 * Math.cos(end_angle * Math::PI / 180)
            end_y = 50 + 50 * Math.sin(end_angle * Math::PI / 180)
            large_arc = angle > 180 ? 1 : 0
          %>
          <path 
            d="M 50 50 L <%= start_x %> <%= start_y %> A 50 50 0 <%= large_arc %> 1 <%= end_x %> <%= end_y %> Z"
            fill="<%= colors[rating] %>"
          />
          <% start_angle = end_angle %>
        <% end %>
        
        <circle cx="50" cy="50" r="25" fill="white"/>
        
        <text x="50" y="45" 
              text-anchor="middle" 
              dominant-baseline="middle" 
              class="text-lg font-medium"
              fill="#202020"
              transform="rotate(90 50 50)">
          <%= total.to_i %>
        </text>
        <text x="50" y="58" 
              text-anchor="middle" 
              dominant-baseline="middle" 
              class="text-[10px]"
              fill="#6B7280"
              transform="rotate(90 50 50)">
          Total
        </text>
      </svg>
    </div>
    
    <div class="flex gap-4 flex-wrap justify-center text-sm text-[#4B4B4B] px-4">
      <% @surveys_by_rating.sort.reverse.each do |rating, _| %>
        <div class="flex items-center gap-2">
          <div class="w-[6px] h-[6px] rounded-full" style="background-color: <%= colors[rating] %>"></div>
          <span class="text-sm"><%= rating %> Stars</span>
        </div>
      <% end %>
    </div>
  </div>
</div>